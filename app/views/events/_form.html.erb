<%= stylesheet_link_tag 'event' %>


<div class="container">
  <%= simple_form_for @event, html: { class: 'green_form' } do |f| %>
    <%= f.error_notification %>

    <div class="form-inputs">
      <%= f.input :title, label: 'Titre', required: true %>
      <%= f.input :description, as: :text, class: "form-control string optional", input_html: {rows: 5}, label: 'Description' %> </br>
      <% if @event.image.url.present? %>
        <%= cl_image_tag @event.image.file.filename, width: 470, height: 142 %>
      <% end %>

      <!-- upload the image but not recorded directly : association with cloudy record -->
      <%= f.input :image, label: 'Image' %>
      <%= f.input :price_min, label: 'Prix min' %>
      <%= f.input :price_max, label: 'Prix max' %>
      <%= f.input :members_max, label: 'Nb de participants maxi' %>
      <%= f.input :address, label: 'Adresse' %>
      <%= f.input :city, label: 'Ville' %>
      <%= f.input :zip, label: 'CP' %>

      <% if @event.persisted? && false %> # not now yet
<!--         <%= f.input :photo1 , label: 'Photos 1' %>
        <% if @event.photo1.url.present? %>
          <%= cl_image_tag @event.photo1.file.filename, width: 200, height: 200 %>
        <% end %>
        <%= f.input :photo2 , label: 'Photos 2' %>
        <% if @event.photo2.url.present? %>
          <%= cl_image_tag @event.photo2.file.filename, width: 200, height: 200 %>
        <% end %>
        <%= f.input :photo3 , label: 'Photos 3' %>
        <% if @event.photo3.url.present? %>
          <%= cl_image_tag @event.photo3.file.filename, width: 200, height: 200 %>
        <% end %>
        <%= f.input :photo4 , label: 'Photos 4' %>
        <% if @event.photo4.url.present? %>
          <%= cl_image_tag @event.photo4.file.filename, width: 200, height: 200 %>
        <% end %>
        <%= f.input :photo5 , label: 'Photos 5' %>
        <% if @event.photo5.url.present? %>
          <%= cl_image_tag @event.photo5.file.filename, width: 200, height: 200 %>
        <% end %>
 -->      <% end %>

      <hr>

      <!-- Warning  Event.calendar_string set by calendarsPicker-->

      <%= f.input :calendar_string, label: 'Calendrier pour des événements sur une journée' %>

      <% if @event.persisted? %>
        L'événement est prévu le : <span class="btn btn-default"> <%= I18n.l(@event.begin_at, format: '%d/%m/%Y') %> </span>
      <% end %>


      <% if browser.firefox? %>
        </br>
      <% end %>

      Heure de début :
      <%= f.time_select :begin_at, minute_step: 15 %>

      Heure de fin :
      <%= f.time_select :end_at, minute_step: 15 %>
      </br>
      <div class="container" style="display: block; text-align: center; width: 100%;" id="daysPickerBlock">
        <div style="display: flex; justify-content: space-around;">
          <div style="align-items: center;" id="choiceDate">
            <div>Choisir une ou plusieurs dates</div>
            <div>
              <input type="text" size="7" id="dayPicker" class="btn btn-default">
            </div>
          </div>
          <div  style="align-items: center;">
            <div>Les dates choisies :</div>
            <div type="text" size="30" id="dayAlternate" readonly="readonly" style=" margin-left: 20px "></div>
          </div>
        </div>
      </br>
      </div>

      <div class="container" style="display: block; text-align: center; width: 100%;" id="rangePickerBlock">
        <div style="display: flex; justify-content: space-around;">
          <div style="align-items: center;" id="choiceRange">
            <div>Choisir un intervalle</div>
            <div>
              <input type="text" size="18" id="range2Picker" class="btn btn-default">
            </div>
          </div>

        </div>
      </br>
      </div>

      <% if @event.multi_dates_id && @event.persisted? %>
        <h4> Type de modification</h4>
        <div style="text-align: left">
          <ul style="list-style-type:none">
            <li>
              <%= radio_button_tag(:type_update, UPDATE_TYPE_ONLY_ONE, checked: true ) %>
              <%= label_tag(:Only, "Appliquer uniquement à cet événement") %>
            </li>
            <li>
              <%= radio_button_tag(:type_update, UPDATE_TYPE_ALL_AFTER) %>
              <%= label_tag(:All_after, "Appliquer à cet événement et les suivants") %>
            </li>
            <li>
              <%= radio_button_tag(:type_update, UPDATE_TYPE_ALL_ITEMS) %>
              <%= label_tag(:All_items, "Appliquer à tous les événements") %>
            </li>
          </ul>
        </div>
      <% end %>
    </div>
    </br>
    </br>
    <div class="form-actions btn-group btn-group-justified" role="group">
      <div class="btn-group" role="group">
        <%= f.button :submit, "Enregistrer", class: 'btn btn-default' %>
      </div>
      <% if @event.persisted? %>
        <div class="btn-group" role="group">
          <%= f.button :submit, ACTION_SUPPRIMER, class: 'btn btn-default',  data: {confirm: 'Confirmez la/les suppressions' }  %>
        </div>
      <% end %>
      <div class="btn-group" role="group">
        <%= link_to 'Annuler', session[:request_back], class: 'btn btn-default' %>
      </div>
    </div>
  <% end %>
</div>

<script>

// Set Event.calendar_string by #ln10Picker
  $('#event_calendar_string').hide();

  <% if @event.persisted? && @event.multi_dates_id %>
    // If update not allow dayPicker for multi dates
    $('#choiceDate').hide();
    // $('#event_begin_at_4i').prop('disabled', true);
    // $('#event_begin_at_5i').prop('disabled', true);
    // $('#event_end_at_4i').prop('disabled', true);
    // $('#event_end_at_5i').prop('disabled', true);
  <% end %>

  $('#range2Picker').calendarsPicker({
    rangeSelect: true,
    monthsToShow: 2,
    showTrigger: '#calImg',
    dateFormat: 'dd/mm/yyyy',
    altField: '#event_calendar_string',
    altFormat: 'dd/mm/yyyy',
    prevText: '&#x3c;Préc',
    prevStatus: 'Voir le mois précédent',
    prevJumpText: '&#x3c;&#x3c;',
    prevJumpStatus: 'Voir l\'année précédent',
    nextText: 'Suiv&#x3e;',
    nextStatus: 'Voir le mois suivant',
    nextJumpText: '&#x3e;&#x3e;',
    nextJumpStatus: 'Voir l\'année suivant',
    currentText: 'Courant',
    currentStatus: 'Voir le mois courant',
    todayText: 'Aujourd\'hui',
    todayStatus: 'Voir aujourd\'hui',
    clearText: 'Effacer',
    clearStatus: 'Effacer la date sélectionnée',
    closeText: 'Fermer',
    closeStatus: 'Fermer sans modifier',
    yearStatus: 'Voir une autre année',
    monthStatus: 'Voir un autre mois',
    weekText: 'Sm',
    weekStatus: 'Semaine de l\'année',
    dayStatus: '\'Choisir\' le DD d MM',
    defaultStatus: 'Choisir la date',
  });

  // Get value from model
  $('#dayPicker')[0].value = $('#event_calendar_string')[0].value;


  $('#dayPicker').calendarsPicker($.extend({
    showTrigger: '#calImg',
    // only if edit & no multi dates
    <% if @event.persisted? && !@event.multi_dates_id %>
      multiSelect: 0,
    <% else %>
      multiSelect: 400,
    <% end %>
    dateFormat: 'dd/mm/yyyy',
    altField: '#event_calendar_string',
    altFormat: 'dd/mm/yyyy',
    prevText: '&#x3c;Préc',
    prevStatus: 'Voir le mois précédent',
    prevJumpText: '&#x3c;&#x3c;',
    prevJumpStatus: 'Voir l\'année précédent',
    nextText: 'Suiv&#x3e;',
    nextStatus: 'Voir le mois suivant',
    nextJumpText: '&#x3e;&#x3e;',
    nextJumpStatus: 'Voir l\'année suivant',
    currentText: 'Courant',
    currentStatus: 'Voir le mois courant',
    todayText: 'Aujourd\'hui',
    todayStatus: 'Voir aujourd\'hui',
    clearText: 'Effacer',
    clearStatus: 'Effacer la date sélectionnée',
    closeText: 'Fermer',
    closeStatus: 'Fermer sans modifier',
    yearStatus: 'Voir une autre année',
    monthStatus: 'Voir un autre mois',
    weekText: 'Sm',
    weekStatus: 'Semaine de l\'année',
    dayStatus: '\'Choisir\' le DD d MM',
    defaultStatus: 'Choisir la date',

  }));

  $('#dayPicker').change(function(){
    console.log('Changed');
   tabString = $('#event_calendar_string')[0].value.split(',').sort(function(a, b){
    var aDate = a.split("/");
    var date1 = aDate[2]+aDate[1]+ aDate[0];
    var bDate = b.split("/");
    var date2 = bDate[2] + bDate[1] + bDate[0];
    return date1 > date2;
    });

//  KEVIN : Je ne sais pas pourquoi on a besoin des deux ??? Premier pour recaluler day Picker, le deuxieme pour afficher dayAltenate
    $('#dayAlternate')[0].value =tabString.join('<br>');
    $('#dayPicker')[0].value = tabString.join(',');

    $('#dayAlternate').html(tabString.join('<br>'));
    $('#dayPicker').html(tabString.join(','));
  });

  // $('#dayPicker').autocomplete(function(){});

  // $('#event_begin_at_4i').autocomplete(function(){});

  showDates();

  function showDates() {
    tabString = $('#event_calendar_string')[0].value.split(',').sort();
    $('#dayAlternate').html(tabString.join('<br>'));
  }

  ($.datepicker.regionalOptions['fr']);

  /* http://keith-wood.name/datepick.html
   French localisation for jQuery Datepicker.
   Stéphane Nahmani (sholby@sholby.net). */
(function($) {
  'use strict';
  $.datepicker.regionalOptions = {
    monthNames: ['Janvier','Février','Mars','Avril','Mai','Juin',
    'Juillet','Août','Septembre','Octobre','Novembre','Décembre'],
    monthNamesShort: ['Jan','Fév','Mar','Avr','Mai','Jun',
    'Jul','Aoû','Sep','Oct','Nov','Déc'],
    dayNames: ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],
    dayNamesShort: ['Dim','Lun','Mar','Mer','Jeu','Ven','Sam'],
    dayNamesMin: ['Di','Lu','Ma','Me','Je','Ve','Sa'],
    dateFormat: 'dd/mm/yyyy',
    firstDay: 1,
    renderer: $.datepicker.defaultRenderer,
    prevText: '&#x3c;Préc',
    prevStatus: 'Voir le mois précédent',
    prevJumpText: '&#x3c;&#x3c;',
    prevJumpStatus: 'Voir l\'année précédent',
    nextText: 'Suiv&#x3e;',
    nextStatus: 'Voir le mois suivant',
    nextJumpText: '&#x3e;&#x3e;',
    nextJumpStatus: 'Voir l\'année suivant',
    currentText: 'Courant',
    currentStatus: 'Voir le mois courant',
    todayText: 'Aujourd\'hui',
    todayStatus: 'Voir aujourd\'hui',
    clearText: 'Effacer',
    clearStatus: 'Effacer la date sélectionnée',
    closeText: 'Fermer',
    closeStatus: 'Fermer sans modifier',
    yearStatus: 'Voir une autre année',
    monthStatus: 'Voir un autre mois',
    weekText: 'Sm',
    weekStatus: 'Semaine de l\'année',
    dayStatus: '\'Choisir\' le DD d MM',
    defaultStatus: 'Choisir la date',
    isRTL: false
  };

  $.datepicker.setDefaults($.datepicker.regionalOptions);
})(jQuery);

</script>
