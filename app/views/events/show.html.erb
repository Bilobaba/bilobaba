<%= stylesheet_link_tag 'event' %>

<p id="notice"><%= notice %></p>

<div id="show_event">

  <div id="event">

    <h3><%= @event.title %></h3>

    <div>

      <% if @event.image.url.present? %>
        <%= cl_image_tag( @event.image.file.filename, width: 824, height:182, radius: 10 ) %>
      <% end %>

      <table id="show_event">
        <tr><td>Date et heure</td><td>: <%= @event.begin %></td></tr>
        <tr><td>Prix</td><td>: <%= @event.price_max %>â‚¬</td></tr>
        <% # TODO Display a maps picto, and show maps on mouse hover %>
        <tr><td>Lieu</td><td>: <%= @event.zip %></td></tr>
        <tr><td>Organisateur</td><td>: <%= @event.organizer.pseudo %></td></tr>
        <tr><td>Description</td><td></td></tr>
      </table>
        <p> <%= @event.description[0..400] %> ... </p>
      <div>


        <% if @event.participate?(current_member) %>
          <%= link_to 'Y aller : Oui', participate_path(id: @event.id, status: 'out'), class: 'badge', remote: true %>
        <% else %>
          <%= link_to 'Y aller : Non', participate_path(id: @event.id, status: 'in'), class: 'badge', remote: true if @event.attendees.size != @event.members_max %>
        <% end %>

        <% if @event.like?(current_member) %>
          <%= link_to 'Aimer : Oui', like_path(id: @event.id, status: 'out'), class: 'badge', remote: true %>
        <% else %>
          <%= link_to 'Aimer : Non', like_path(id: @event.id, status: 'in'), class: 'badge', remote: true %>
        <% end %>


        <% if @event.recommend?(current_member) %>
          <%= link_to 'Recommander : Oui', recommend_path(id: @event.id, status: 'out'), class: 'badge', remote: true %>
        <% else %>
          <%= link_to 'Recommander : Non', recommend_path(id: @event.id, status: 'in'), class: 'badge', remote: true %>
        <% end %>

        <% if @event.follow?(current_member) %>
          <%= link_to 'Suivre : Oui', follow_path(id: @event.id, status: 'out'), class: 'badge', remote: true %>
        <% else %>
            <%= link_to 'Suivre : Non', follow_path(id: @event.id, status: 'in'), class: 'badge', remote: true %>
        <% end %>

        </br>
        <% if member_signed_in? && (current_member == @event.organizer) %>
          <%= link_to 'Modifier', edit_event_path, class: 'badge' %>
          <%= link_to 'Supprimer', event_path, class: 'badge', method: 'DELETE', data: {confirm: 'Confirmez la suppression' } %>
        <% end %>

        <%= link_to 'Retour', events_path, class: 'badge' %>

      </div>
    </div>
    <!-- <div id="map"></div> -->
        <%= cl_image_tag( @event.photos[0].file.filename, width: 824, height:182, radius: 10 ) %>

  </div>

  <div id="discussion">
        <h3>Des questions ? Envie d'en discuter ?</h3>

        <div id="comments">
        <% @event.comments.each do |comment| %>
            <%= render comment %>
        <% end %>
        </div>

        <% # FIXME Only display this form is a user is connected %>
        <%= simple_form_for [@event, @comment], remote: true do |f| %>
            <%= f.input :content, label: false %>
            <%= f.button :submit, 'Envoyer le commentaire' %>
        <% end %>

  </div>

</div>

<%= javascript_tag do %>
  var map;
  function initMap() {
      var myLatlng = new google.maps.LatLng(40, 0);
      map = new google.maps.Map(document.getElementById('map'), {
          center: myLatlng,
          zoom: 5
      });
      var marker = new google.maps.Marker({
          position: myLatlng,
          map: map
      });
      var infowindow = new google.maps.InfoWindow({
          content: 'ici'
      });
      marker.addListener('click', function() {
          infowindow.open(map, marker);
      });
  }
<% end  %>

<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_API'] %>&callback=initMap"
async defer></script>

